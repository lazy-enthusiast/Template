<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Bangkok 2026 (Night Mode)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Noto+Serif+TC:wght@300;400;600&display=swap" rel="stylesheet">

<style>
/* --- 1. è¨­è¨ˆèªè¨€ (Deep Night & Gold) --- */
:root {
    --bg-body: #1A1A2E; /* æ·±å¤œè—èƒŒæ™¯ */
    --bg-card: #232336; /* å¡ç‰‡æ·±è—ç° */
    --bg-input: #2E2E42;
    --text-main: #EEEEEE; /* ç±³ç™½æ–‡å­— */
    --text-sub: #A0A0A0; /* æ·ºç°è¼”åŠ©å­— */
    --accent: #D4AF37; /* å¥¢è¯é‡‘ */
    --accent-hover: #B5932A;
    --border: rgba(255, 255, 255, 0.1); /* å¾®å¼±é‚Šæ¡† */
    --header-bg: #1A1A2E;
    --shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    --safe-top: env(safe-area-inset-top);
    --safe-bottom: env(safe-area-inset-bottom);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

body {
    font-family: "Noto Serif TC", serif;
    background-color: var(--bg-body);
    color: var(--text-main);
    margin: 0; padding: 0;
    height: 100vh;
    display: flex; flex-direction: column; overflow: hidden;
}

h1, h2, h3, .weather-temp-lg, .day-num, .phrase-big, .page-title {
    font-family: "Playfair Display", serif;
}

/* --- Header --- */
header {
    padding: 0 20px;
    padding-top: var(--safe-top);
    background-color: var(--header-bg);
    color: var(--accent);
    border-bottom: 1px solid var(--border);
    display: flex; justify-content: space-between; align-items: center;
    height: calc(60px + var(--safe-top)); flex-shrink: 0; position: relative; z-index: 200;
}
header h1 { margin: 0; font-size: 1.2rem; font-weight: 700; letter-spacing: 1px; color: var(--accent); }
.header-actions { display: flex; align-items: center; gap: 8px; }
.header-btn { 
    font-size: 1.2rem; cursor: pointer; color: var(--text-main); 
    border-radius: 50%; width: 40px; height: 40px;
    display: flex; justify-content: center; align-items: center;
    transition: background 0.2s;
}

/* --- Navigation --- */
nav.bottom-nav { 
    position: fixed; bottom: 0; width: 100%; 
    background-color: var(--bg-card); 
    display: flex; justify-content: space-around; 
    padding: 12px 0 calc(20px + var(--safe-bottom)) 0; 
    border-top: 1px solid var(--border); 
    z-index: 100; box-shadow: 0 -5px 20px rgba(0,0,0,0.2); 
}
.nav-item { color: var(--text-sub); text-align: center; font-size: 0.7rem; cursor: pointer; width: 20%; transition: color 0.2s; }
.nav-item i { display: block; font-size: 1.3rem; margin-bottom: 4px; }
.nav-item.active { color: var(--accent); }

/* --- Sidebar --- */
.sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(5px); }
.sidebar-overlay.open { opacity: 1; pointer-events: all; }
.sidebar { position: fixed; top: 0; right: 0; width: 85%; max-width: 320px; height: 100%; background: var(--bg-body); z-index: 1001; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); overflow-y: auto; padding: 25px 20px 100px 20px; padding-top: calc(30px + var(--safe-top)); box-shadow: -5px 0 20px rgba(0,0,0,0.5); display: flex; flex-direction: column; border-left: 1px solid var(--border); }
.sidebar.open { transform: translateX(0); }
.sidebar-section-title { font-size: 0.75rem; color: var(--accent); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 12px; margin-top: 30px; font-weight: 700; border-bottom: 1px solid var(--border); padding-bottom: 5px; }

/* Navigation Launchers (Buttons in Sidebar) */
.nav-launcher {
    display: flex; align-items: center; gap: 12px;
    background: var(--bg-card); border: 1px solid var(--border); padding: 15px;
    border-radius: 8px; margin-bottom: 10px; cursor: pointer;
    transition: all 0.2s;
}
.nav-launcher:active { background: var(--border); transform: scale(0.98); }
.nav-launcher-icon { font-size: 1.3rem; color: var(--accent); width: 30px; text-align: center; }
.nav-launcher h3 { margin: 0; font-size: 1rem; font-weight: 700; color: var(--text-main); }
.nav-launcher p { margin: 2px 0 0 0; font-size: 0.75rem; color: var(--text-sub); }

/* Components */
.whatsapp-box { background: rgba(37, 211, 102, 0.1); border: 1px solid rgba(37, 211, 102, 0.3); color: var(--text-main); padding: 15px; border-radius: 8px; margin-bottom: 10px; margin-top: 10px; }
.wa-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border); border-radius: 4px; font-size: 0.95rem; font-family: inherit; background: var(--bg-input); color: white; }
.wa-btn { width: 100%; background: #25D366; color: white; border: none; padding: 12px; border-radius: 4px; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 0.9rem; }

.tool-box { background: var(--bg-card); padding: 20px; border-radius: 8px; border: 1px solid var(--border); margin-bottom: 10px; box-shadow: var(--shadow); }
.currency-grid { display: grid; grid-template-columns: 1fr 30px 1fr; align-items: center; gap: 5px; margin-bottom: 8px; }
.curr-group { display: flex; flex-direction: column; }
.curr-label { font-size: 0.7rem; color: var(--accent); font-weight: bold; margin-bottom: 4px; padding-left: 2px;}
.curr-input { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 4px; font-size: 1.2rem; text-align: center; background: var(--bg-input); font-weight: 500; font-family: 'Playfair Display', serif; color: var(--text-main); }
.curr-icon { text-align: center; color: var(--text-sub); font-size: 0.9rem; margin-top: 15px;} 
.memo-area { width: 100%; height: 100px; padding: 10px; border: 1px solid var(--border); border-radius: 4px; font-family: inherit; font-size: 0.9rem; resize: none; background: var(--bg-input); color: var(--text-main); }

/* --- Main Content --- */
main { flex: 1; overflow-y: hidden; position: relative; }
.page { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; padding: 20px 0 100px 0; display: none; opacity: 0; transition: opacity 0.2s ease; background-color: var(--bg-body); }
.page.active { display: block; opacity: 1; z-index: 10; }
.page-header { padding: 0 20px; margin-bottom: 20px; text-align: center;}
.page-title { font-size: 1.8rem; font-weight: 700; margin: 0; color: var(--text-main); letter-spacing: 1px; position: relative; display: inline-block; }
.page-title::after { content: ''; display: block; width: 40px; height: 2px; background: var(--accent); margin: 10px auto 0 auto; }

/* Date Selector */
.date-selector-container { background: var(--bg-card); padding: 15px; border-bottom: 1px solid var(--border); width: 100%; flex-shrink: 0; position: relative; z-index: 90; display: block; }
.date-selector { display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none; padding-bottom: 5px; }
.date-chip { flex: 1 0 auto; min-width: 75px; padding: 12px 0; border-radius: 4px; cursor: pointer; color: var(--text-sub); display: flex; flex-direction: column; align-items: center; justify-content: center; background: var(--bg-body); border: 1px solid transparent; transition: all 0.2s; }
.date-chip.active { background: var(--accent); color: #000; border-color: var(--accent); box-shadow: 0 0 10px rgba(212, 175, 55, 0.4); }
.day-num { font-weight: 700; font-size: 1rem; margin-bottom: 2px;} 
.day-week { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px; }

/* Timeline & Cards */
.timeline-container { padding: 0 20px; max-width: 800px; margin: 0 auto; }
.timeline-item { position: relative; padding-left: 28px; padding-bottom: 25px; border-left: 1px solid rgba(255,255,255,0.2); }
.timeline-item:last-child { border-left: 1px solid transparent; }
.timeline-item::before { content: ''; position: absolute; left: -6px; top: 22px; width: 11px; height: 11px; background: var(--bg-body); border: 2px solid var(--accent); border-radius: 50%; box-shadow: 0 0 0 3px var(--bg-body); z-index: 2; }
.card { background-color: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 20px; padding-right: 50px; box-shadow: var(--shadow); cursor: pointer; position: relative; transition: transform 0.2s; }
.card:active { transform: scale(0.98); background: #2A2A40; }
.card-time { font-size: 0.8rem; color: var(--accent); font-weight: 600; margin-bottom: 6px; display: block; letter-spacing: 0.5px; }
.card-title { font-size: 1.2rem; font-weight: 700; margin: 0 0 8px 0; color: var(--text-main); }
.tags { display: flex; gap: 6px; flex-wrap: wrap; }
.card-tag { font-size: 0.7rem; background: var(--bg-body); padding: 4px 12px; border-radius: 20px; color: var(--text-sub); border: 1px solid var(--border); }
.card-nav-btn { 
    position: absolute; top: 50%; right: 15px; transform: translateY(-50%); 
    width: 34px; height: 34px; border-radius: 50%; 
    background: var(--bg-body); color: var(--accent); 
    display: flex; justify-content: center; align-items: center; 
    font-size: 0.9rem; border: 1px solid var(--border); z-index: 5; 
}

/* Weather (Dark/Gold Style) */
.weather-main-card {
    background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
    color: var(--accent); border-radius: 12px; padding: 25px;
    margin: 0 20px 20px 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    text-align: center; position: relative; overflow: hidden; border: 1px solid rgba(212, 175, 55, 0.3);
}
.weather-icon-lg { font-size: 3.5rem; margin: 15px 0; color: #FFF; filter: drop-shadow(0 0 10px rgba(255,255,255,0.3)); }
.weather-temp-lg { font-size: 3.5rem; font-weight: 400; letter-spacing: -1px; color: var(--accent); }
.weather-desc { font-size: 1rem; margin-bottom: 10px; font-weight: 500; color: #EEE; }
.weather-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 0 20px; }
.weather-stat-card { background: var(--bg-card); border: 1px solid var(--border); padding: 15px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: var(--shadow); }

/* Inspiration & Shop */
.filter-bar-container { padding: 0 20px 15px 20px; position: sticky; top: 0; z-index: 50; background: var(--bg-body); overflow-x: auto; white-space: nowrap; scrollbar-width: none; }
.filter-chip { display: inline-block; padding: 8px 18px; margin-right: 8px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; font-size: 0.85rem; color: var(--text-sub); cursor: pointer; transition: all 0.2s; }
.filter-chip.active { background: var(--accent); color: #000; border-color: var(--accent); }
.inspiration-grid { padding: 0 20px; display: grid; gap: 15px; }
.inspire-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 25px; color: var(--text-main); position: relative; display: block; box-shadow: var(--shadow); } 
.inspire-card.hidden { display: none; }
.inspire-badge { background: var(--accent); color: #000; padding: 2px 10px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; position: absolute; top: -10px; left: 20px; letter-spacing: 1px; }
.shopping-list { padding: 0 20px; }
.shop-item { background: var(--bg-card); padding: 18px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: var(--shadow); }
.shop-item.checked { opacity: 0.4; }
.shop-item.checked label { text-decoration: line-through; color: var(--text-sub); }
.shop-item input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--accent); }

/* Info Page & Phrases */
.info-card { background: var(--bg-card); padding: 25px; border-radius: 8px; margin: 0 20px 15px 20px; border: 1px solid var(--border); box-shadow: var(--shadow); }
.info-header { font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; color: var(--text-main); display: flex; justify-content: space-between; align-items: center; font-family: 'Playfair Display', serif; }
.info-row { display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-start; font-size: 0.95rem; color: var(--text-main); }
.info-icon { color: var(--accent); width: 20px; text-align: center; margin-top: 3px; }
.info-label { display: block; font-size: 0.75rem; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2px; }
.phrase-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 20px 40px 20px; }
.phrase-card { background: var(--bg-card); border: 1px solid var(--border); padding: 20px 15px; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow); aspect-ratio: 1.25; display: flex; flex-direction: column; justify-content: center; align-items: center; }
.phrase-card:active { background: var(--accent); }
.phrase-card:active * { color: #000; }
.phrase-jp { font-weight: 700; font-size: 1.1rem; margin-bottom: 8px; color: var(--text-main); }
.phrase-zh { font-size: 0.85rem; color: var(--text-sub); }
.phrase-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(26, 26, 46, 0.98); z-index: 5000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
.phrase-overlay.active { opacity: 1; pointer-events: all; }
.phrase-content { text-align: center; width: 85%; }
.phrase-big { font-size: 2.5rem; font-weight: 700; color: var(--accent); line-height: 1.3; margin-bottom: 20px; }
.close-phrase { position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); border: 1px solid var(--accent); padding: 12px 30px; border-radius: 30px; color: var(--accent); cursor: pointer; background: transparent; font-weight: 600; letter-spacing: 1px; }

/* Modal */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; justify-content: center; align-items: end; backdrop-filter: blur(5px); }
.modal.open { display: flex; }
.modal-content { background: var(--bg-card); color: var(--text-main); width: 100%; max-width: 600px; max-height: 90vh; border-radius: 20px 20px 0 0; padding: 30px; overflow-y: auto; animation: slideUp 0.3s ease; display: flex; flex-direction: column; border: 1px solid var(--border); border-bottom: none; }
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
#modal-mini-map { width: 100%; height: 200px; background: #111; border-radius: 12px; margin-bottom: 25px; border: 1px solid var(--border); flex-shrink: 0;}
.modal-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
.modal-label { font-size: 0.7rem; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1.5px; display: block; margin-bottom: 5px; }
.modal-value { font-size: 1rem; font-weight: 500; color: var(--text-main); }
.modal-note-box { background: var(--bg-body); padding: 20px; border-radius: 8px; border-left: 4px solid var(--accent); margin: 20px 0; font-size: 0.95rem; line-height: 1.7; color: #DDD; white-space: pre-line; }
.btn-action { width: 100%; padding: 15px; border-radius: 6px; border: none; font-weight: 600; cursor: pointer; font-size: 0.95rem; text-align: center; margin-bottom: 10px; display:flex; justify-content:center; align-items:center; gap:8px;}
.btn-black { background: var(--accent); color: #000; }
.btn-outline { background: transparent; border: 1px solid var(--accent); color: var(--accent); }

/* Force Leaflet Dark Mode Tiles filter */
.leaflet-layer { filter: invert(100%) hue-rotate(180deg) brightness(95%) contrast(90%); }
</style>
</head>
<body>

<header>
<h1>BANGKOK <span style="font-weight:300; opacity:0.7; font-size:0.9rem;">2026</span></h1>
<div class="header-actions">
<div class="header-btn" onclick="openTranslate()"><i class="fa-solid fa-language"></i></div>
<div class="header-btn" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>
</div>
</header>

<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
    <div class="whatsapp-box">
        <div style="font-weight:bold; margin-bottom:5px; color:#1B5E20;"><i class="fa-brands fa-whatsapp"></i> å®‰å…¨ Check-in</div>
        <input type="tel" id="wa-phone" class="wa-input" placeholder="å°æ–¹é›»è©± (å¦‚ 85291234567)">
        <button class="wa-btn" id="wa-btn" onclick="sendWhatsApp()"><i class="fa-solid fa-paper-plane"></i> ç™¼é€ä½ç½®</button>
    </div>

    <div class="sidebar-section-title">å¿«æ·åŠŸèƒ½</div>
    
    <div class="nav-launcher" onclick="navigateTo('phrases')">
        <div class="nav-launcher-icon"><i class="fa-solid fa-comments"></i></div>
        <div>
            <h3>æ‰‹æŒ‡å°è©±å¡</h3>
            <p>é»æ“Šé–‹å•Ÿå…¨è¢å¹• (å«æ®ºåƒ¹/äº¤é€š)</p>
        </div>
    </div>

    <div class="nav-launcher" onclick="navigateTo('info')">
        <div class="nav-launcher-icon"><i class="fa-solid fa-suitcase"></i></div>
        <div>
            <h3>æ—…ç¨‹è³‡è¨Š</h3>
            <p>é£¯åº—ã€èˆªç­ã€ç·Šæ€¥é›»è©±</p>
        </div>
    </div>

    <div class="sidebar-section-title">å·¥å…·ç®±</div>
    <div class="tool-box">
        <div style="font-weight:bold; margin-bottom:15px; color:var(--text-main);"><i class="fa-solid fa-coins"></i> åŒ¯ç‡ (THB â‡„ HKD)</div>
        <div class="currency-grid">
            <div class="curr-group"><span class="curr-label">THB</span><input type="number" id="curr-thb" class="curr-input" placeholder="0" oninput="convertCurrency()"></div>
            <div class="curr-icon"><i class="fa-solid fa-right-left"></i></div>
            <div class="curr-group"><span class="curr-label">HKD</span><input type="number" id="curr-hkd" class="curr-input" placeholder="0" readonly></div>
        </div>
        <div style="text-align:right; font-size:0.75rem; color:#888; margin-top:5px;">
            <span id="rate-display">è¼‰å…¥ä¸­...</span>
        </div>
    </div>
    <div class="tool-box">
        <div style="font-weight:bold; margin-bottom:10px; color:var(--text-main);"><i class="fa-solid fa-pen"></i> éš¨æ‰‹è¨˜</div>
        <textarea id="quick-memo" class="memo-area" placeholder="æˆ¿è™Ÿã€Wifi..." oninput="saveMemo()"></textarea>
    </div>
</div>

<div id="phrase-overlay" class="phrase-overlay" onclick="closePhrase()">
    <div class="phrase-content"><div id="overlay-jp" class="phrase-big"></div><div id="overlay-zh" class="phrase-sub" style="font-size:1.2rem; color:#FFF;"></div></div>
    <div class="close-phrase">é—œé–‰</div>
</div>

<div class="date-selector-container">
    <div class="date-selector" id="date-selector"></div>
</div>

<main>
    <div id="page-itinerary" class="page active">
        <div class="timeline-container" id="timeline-container"></div>
    </div>

    <div id="page-inspiration" class="page">
        <div class="filter-bar-container">
            <span class="filter-chip active" onclick="filterInspiration('all', this)">å…¨éƒ¨</span>
            <span class="filter-chip" onclick="filterInspiration('RAINY', this)">â˜” é›¨å¤©/å®¤å…§</span>
            <span class="filter-chip" onclick="filterInspiration('PHOTO', this)">ğŸ“· æ‹ç…§</span>
        </div>
        <div id="inspiration-container" class="inspiration-grid"></div>
    </div>

    <div id="page-shopping" class="page">
        <div class="page-header"><h2 class="page-title">è³¼ç‰©æ¸…å–®</h2></div>
        <div id="shopping-container" class="shopping-list"></div>
    </div>

    <div id="page-phrases" class="page">
        <div class="page-header"><h2 class="page-title">æ³°èªæºé€šå¡</h2></div>
        
        <div class="sidebar-section-title" style="margin-left:20px; border:none;">ğŸ´ é¤å»³é£²é£Ÿ</div>
        <div class="phrase-grid">
            <div class="phrase-card" onclick="showPhrase('à¹„à¸¡à¹ˆà¹€à¸œà¹‡à¸”', 'ä¸è¦è¾£ (Mai Phet)')"><div class="phrase-jp">à¹„à¸¡à¹ˆà¹€à¸œà¹‡à¸”</div><div class="phrase-zh">ä¸è¦è¾£</div></div>
            <div class="phrase-card" onclick="showPhrase('à¹€à¸œà¹‡à¸”à¸™à¸´à¸”à¸«à¸™à¹ˆà¸­à¸¢', 'å¾®è¾£ (Phet Nit Noi)')"><div class="phrase-jp">à¹€à¸œà¹‡à¸”à¸™à¸´à¸”à¸«à¸™à¹ˆà¸­à¸¢</div><div class="phrase-zh">å¾®è¾£</div></div>
            <div class="phrase-card" onclick="showPhrase('à¹„à¸¡à¹ˆà¹€à¸­à¸²à¸œà¸±à¸à¸Šà¸µ', 'ä¸è¦é¦™èœ (Mai Ao Phak Chi)')"><div class="phrase-jp">à¹„à¸¡à¹ˆà¹€à¸­à¸²à¸œà¸±à¸à¸Šà¸µ</div><div class="phrase-zh">ä¸è¦é¦™èœ</div></div>
            <div class="phrase-card" onclick="showPhrase('à¹„à¸¡à¹ˆà¹€à¸­à¸²à¸«à¸§à¸²à¸™', 'ä¸è¦ç³– (Mai Ao Wan)')"><div class="phrase-jp">à¹„à¸¡à¹ˆà¹€à¸­à¸²à¸«à¸§à¸²à¸™</div><div class="phrase-zh">ä¸è¦ç³– (é£²æ–™)</div></div>
            <div class="phrase-card" onclick="showPhrase('à¹€à¸Šà¹‡à¸„à¸šà¸´à¸¥', 'è²·å–®/çµå¸³ (Check Bin)')"><div class="phrase-jp">à¹€à¸Šà¹‡à¸„à¸šà¸´à¸¥</div><div class="phrase-zh">è²·å–®</div></div>
            <div class="phrase-card" onclick="showPhrase('à¸­à¸£à¹ˆà¸­à¸¢à¸¡à¸²à¸', 'å¾ˆå¥½åƒ (A-Roi Mak)')"><div class="phrase-jp">à¸­à¸£à¹ˆà¸­à¸¢à¸¡à¸²à¸</div><div class="phrase-zh">å¾ˆå¥½åƒ</div></div>
        </div>

        <div class="sidebar-section-title" style="margin-left:20px; border:none;">ğŸš• äº¤é€šèˆ‡å•è·¯</div>
        <div class="phrase-grid">
            <div class="phrase-card" onclick="showPhrase('à¹„à¸›à¸—à¸µà¹ˆà¸™à¸µà¹ˆà¸„à¸£à¸±à¸š/à¸„à¹ˆà¸°', 'æˆ‘è¦å»é€™è£¡ (Pai Tee Nee)')"><div class="phrase-jp">à¹„à¸›à¸—à¸µà¹ˆà¸™à¸µà¹ˆ...</div><div class="phrase-zh">å»é€™è£¡</div></div>
            <div class="phrase-card" onclick="showPhrase('à¸ˆà¸­à¸”à¸—à¸µà¹ˆà¸™à¸µà¹ˆ', 'åœåœ¨é€™è£¡ (Jod Tee Nee)')"><div class="phrase-jp">à¸ˆà¸­à¸”à¸—à¸µà¹ˆà¸™à¸µà¹ˆ</div><div class="phrase-zh">åœé€™è£¡</div></div>
            <div class="phrase-card" onclick="showPhrase('à¸Šà¹ˆà¸§à¸¢à¹€à¸›à¸´à¸”à¸¡à¸´à¹€à¸•à¸­à¸£à¹Œ', 'è«‹è·³è¡¨ (Chaui Poet Meter)')"><div class="phrase-jp">à¹€à¸›à¸´à¸”à¸¡à¸´à¹€à¸•à¸­à¸£à¹Œ...</div><div class="phrase-zh">è«‹è·³è¡¨</div></div>
            <div class="phrase-card" onclick="showPhrase('à¸«à¹‰à¸­à¸‡à¸™à¹‰à¸³à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆà¹„à¸«à¸™', 'å»æ‰€åœ¨å“ª (Hong Nam Yu Nai)')"><div class="phrase-jp">à¸«à¹‰à¸­à¸‡à¸™à¹‰à¸³...</div><div class="phrase-zh">å»æ‰€åœ¨å“ª</div></div>
        </div>

        <div class="sidebar-section-title" style="margin-left:20px; border:none;">ğŸ›ï¸ è³¼ç‰©èˆ‡æ®ºåƒ¹</div>
        <div class="phrase-grid">
            <div class="phrase-card" onclick="showPhrase('à¹€à¸—à¹ˆà¸²à¹„à¸«à¸£à¹ˆ?', 'å¤šå°‘éŒ¢? (Tao Rai)')"><div class="phrase-jp">à¹€à¸—à¹ˆà¸²à¹„à¸«à¸£à¹ˆ?</div><div class="phrase-zh">å¤šå°‘éŒ¢?</div></div>
            <div class="phrase-card" onclick="showPhrase('à¸¥à¸”à¹„à¸”à¹‰à¹„à¸«à¸¡?', 'å¯ä»¥ä¾¿å®œé»å—? (Lot Dai Mai)')"><div class="phrase-jp">à¸¥à¸”à¹„à¸”à¹‰à¹„à¸«à¸¡?</div><div class="phrase-zh">ä¾¿å®œé»?</div></div>
        </div>
    </div>

    <div id="page-weather" class="page">
        <div id="weather-content">
            <div style="text-align:center; padding:50px; opacity:0.5;"><i class="fa-solid fa-spinner fa-spin fa-2x"></i><p>è¼‰å…¥æ›¼è°·å¤©æ°£ä¸­...</p></div>
        </div>
        <div id="weather-fallback-msg" style="text-align:center; padding:0 20px; color:var(--accent); font-size:0.8rem; display:none;">
            <i class="fa-solid fa-circle-info"></i> ä½¿ç”¨æ™ºæ…§æ­·å²æ•¸æ“š (ç”±æ–¼æ—¥æœŸè¼ƒé )
        </div>
    </div>

    <div id="page-info" class="page">
        <div class="page-header"><h2 class="page-title">æ—…ç¨‹è³‡è¨Š</h2></div>
        <div id="dynamic-info-content"></div>
    </div>
</main>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchMainPage('itinerary', this)"><i class="fa-regular fa-calendar"></i><span>è¡Œç¨‹</span></div>
    <div class="nav-item" onclick="switchMainPage('inspiration', this)"><i class="fa-regular fa-compass"></i><span>æ¢ç´¢</span></div>
    <div class="nav-item" onclick="switchMainPage('shopping', this)"><i class="fa-solid fa-bag-shopping"></i><span>æ¸…å–®</span></div>
    <div class="nav-item" onclick="switchMainPage('weather', this)"><i class="fa-solid fa-cloud"></i><span>å¤©æ°£</span></div>
    <div class="nav-item" onclick="switchMainPage('info', this)"><i class="fa-solid fa-circle-info"></i><span>è³‡è¨Š</span></div>
</nav>

<div id="detail-modal" class="modal">
    <div class="modal-content">
        <div style="position:absolute; top:20px; right:20px; font-size:1.5rem; cursor:pointer;" onclick="closeModal()">Ã—</div>
        <div id="modal-mini-map"></div>
        <div class="modal-header">
            <span class="modal-label" id="modal-type">Type</span>
            <h2 id="modal-title" style="margin:0; font-family:'Playfair Display', serif; font-size:1.5rem;">Title</h2>
        </div>
        <div class="modal-info-grid">
            <div><span class="modal-label">æ™‚é–“</span><span class="modal-value" id="modal-time"></span></div>
            <div><span class="modal-label">é ç®—</span><span class="modal-value" id="modal-price"></span></div>
            <div><span class="modal-label">ç‡Ÿæ¥­æ™‚é–“</span><span class="modal-value" id="modal-open-hours"></span></div>
            <div><span class="modal-label">åœ°å€</span><span class="modal-value" id="modal-address-short" style="font-size:0.85rem;"></span></div>
        </div>
        <div class="modal-label">å‚™è¨»èˆ‡æ”»ç•¥</div>
        <div class="modal-note-box"><div id="modal-note" class="modal-note-content"></div></div>
        <div class="modal-actions" id="modal-actions"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// --- DATA: 5-Day Bangkok Itinerary ---
const scheduleData = {
    "day1": { 
        "date": "2026-05-01", "display": "May 01", "weekday": "é€±äº”", 
        "events": [
            { 
                "time": "17:00", "title": "IR-ON Hotel Check-in", "type": "ä½å®¿", "price": "-", "open_hours": "24H", 
                "address": "10/10 Sukhumvit 36, Bangkok", "address_local": "10/10 à¸‹à¸­à¸¢à¸ªà¸¸à¸‚à¸¸à¸¡à¸§à¸´à¸— 36 à¹à¸‚à¸§à¸‡à¸„à¸¥à¸­à¸‡à¸•à¸±à¸™ à¹€à¸‚à¸•à¸„à¸¥à¸­à¸‡à¹€à¸•à¸¢", 
                "coords": [13.7247, 100.5772], "phone": "+6620740806", 
                "note": "æ©Ÿå ´å¿«ç·š ARL åˆ° Phaya Thaiï¼Œè½‰ BTS åˆ° Thong Lo ç«™ (2è™Ÿå‡ºå£)ã€‚\né£¯åº—è¨­è¨ˆæ„Ÿå¼·ï¼Œå·¥æ¥­é¢¨ï¼Œå°±åœ¨ Thong Lo 36 å··ã€‚", "tags": ["ç§»å‹•", "å…¥ä½"]
            },
            { 
                "time": "19:00", "title": "Supanniga Eating Room", "type": "æ™šé¤", "price": "à¸¿1000", "open_hours": "11:30-22:00", 
                "address": "160/11 Thong Lo 8 Alley, Bangkok", "address_local": "160/11 à¸‹à¸­à¸¢à¸—à¸­à¸‡à¸«à¸¥à¹ˆà¸­ 8",
                "coords": [13.7314, 100.5830], "note": "ç±³å…¶æ—æ¨è–¦æ³°èœã€‚\nå¿…é»ï¼šèŸ¹è‚‰çƒ˜è›‹ã€é¦¬æ’’æ›¼å’–å“©ã€‚\nå»ºè­°äº‹å…ˆè¨‚ä½ã€‚", "tags": ["ç¾é£Ÿ"]
            },
            {
                "time": "21:00", "title": "Asia Herb Association", "type": "æŒ‰æ‘©", "price": "à¸¿800", "open_hours": "09:00-02:00", 
                "address": "Sukhumvit 24, Bangkok", "address_local": "à¸‹à¸­à¸¢à¸ªà¸¸à¸‚à¸¸à¸¡à¸§à¸´à¸— 24",
                "coords": [13.7290, 100.5695], "note": "Thong Lo é™„è¿‘ä¹Ÿæœ‰åˆ†åº—ã€‚\næ¨è–¦æ‹›ç‰Œè‰è—¥çƒæŒ‰æ‘© (Herbal Ball)ï¼Œæ¶ˆæ°´è…«ç¥ç‰©ã€‚", "tags": ["æ”¾é¬†"]
            }
        ],
        "inspiration": [], 
        "shopping": ["ä¾¿åˆ©å•†åº—ç†±å£“åå¸", "æ³°åœ‹ SIM å¡"] 
    },
    "day2": { 
        "date": "2026-05-02", "display": "May 02", "weekday": "é€±å…­", 
        "events": [
            { 
                "time": "10:00", "title": "Wat Arun (é„­ç‹å»Ÿ)", "type": "æ™¯é»", "price": "à¸¿100", "open_hours": "08:00-18:00", 
                "address": "158 Thanon Wang Doem, Bangkok", "address_local": "à¸§à¸±à¸”à¸­à¸£à¸¸à¸“à¸£à¸²à¸Šà¸§à¸£à¸²à¸£à¸²à¸¡à¸£à¸²à¸Šà¸§à¸£à¸¡à¸«à¸²à¸§à¸´à¸«à¸²à¸£", 
                "coords": [13.7437, 100.4888], "note": "æ­èˆ¹åˆ° N8 Tha Tien ç¢¼é ­å°é¢ã€‚\nç©¿è‘—å»ºè­°ï¼šç™½è‰²æˆ–æ·ºè‰²ç³»è¡£æœï¼Œæ‹ç…§æœ€ç¾ã€‚\nè«‹å‹¿ç©¿è‘—æš´éœ²æœè£ã€‚", "tags": ["æ–‡åŒ–", "æ‹ç…§"]
            },
            { 
                "time": "13:00", "title": "The Deck by The River", "type": "åˆé¤", "price": "à¸¿600", "open_hours": "11:00-22:00", 
                "address": "36-38 Pratu Nokyung Alley, Bangkok", "address_local": "à¸‹à¸­à¸¢à¸›à¸£à¸°à¸•à¸¹à¸™à¸à¸¢à¸¹à¸‡",
                "coords": [13.7445, 100.4907], "note": "å¯ä»¥ç›´æ¥çœ‹åˆ°é„­ç‹å»Ÿæ²³æ™¯çš„é¤å»³ï¼Œéå¸¸é©åˆåˆä¼‘ã€‚", "tags": ["ç¾é£Ÿ"]
            },
            {
                "time": "16:00", "title": "ICONSIAM", "type": "è³¼ç‰©", "price": "-", "open_hours": "10:00-22:00", 
                "address": "299 Charoen Nakhon Rd, Bangkok", "address_local": "à¹„à¸­à¸„à¸­à¸™à¸ªà¸¢à¸²à¸¡",
                "coords": [13.7267, 100.5113], "note": "å¿…é€›ï¼šGæ¨“ã€Œå®¤å…§æ°´ä¸Šå¸‚å ´ã€(SookSiam)ï¼Œå†·æ°£å¼·ï¼Œå°åƒå¤šã€‚\nå‚æ™šå¯åˆ°æ²³æ¿±å»£å ´çœ‹å™´æ°´ç§€ã€‚", "tags": ["è³¼ç‰©"]
            }
        ],
        "inspiration": [
             {tag:"RAINY", title:"ICONSIAM é›»å½±é™¢", note:"å¦‚æœä¸‹å¤§é›¨ï¼ŒICONSIAM æ¨“ä¸Šæœ‰è¶…è±ªè¯é›»å½±é™¢ã€‚"},
             {tag:"PHOTO", title:"% Arabica Iconsiam", note:"æ•´é–“åº—ç´”ç™½è¨­è¨ˆï¼ŒåŠ ä¸Šé¡é¢å¤©èŠ±æ¿ï¼Œæ‹ç…§ç¥é»ã€‚"}
        ],
        "shopping": ["NaRaYa æ›¼è°·åŒ…", "æ‰‹æ¨™æ³°å¼èŒ¶è‘‰"] 
    },
    "day3": {
        "date": "2026-05-03", "display": "May 03", "weekday": "é€±æ—¥",
        "events": [
            { 
                "time": "11:00", "title": "Central World & å››é¢ä½›", "type": "è³¼ç‰©", "price": "-", "open_hours": "10:00-22:00", 
                "address": "Ratchadamri Rd, Bangkok", "address_local": "à¹€à¸‹à¹‡à¸™à¸—à¸£à¸±à¸¥à¹€à¸§à¸´à¸¥à¸”à¹Œ / à¸¨à¸²à¸¥à¸—à¹‰à¸²à¸§à¸¡à¸«à¸²à¸à¸£à¸«à¸¡",
                "coords": [13.7441, 100.5404], "note": "BTS Chit Lom ç«™ã€‚\næ‹œå››é¢ä½›ï¼šé †æ™‚é‡æ‹œï¼Œæ¯é¢æ”¾èŠ±ä¸²èˆ‡é¦™ã€‚\nCentral World 2æ¨“æœ‰ Groove é…’å§å€ã€‚", "tags": ["è³¼ç‰©", "ç¥ˆç¦"]
            },
            {
                "time": "15:00", "title": "After You Dessert Cafe", "type": "ä¸‹åˆèŒ¶", "price": "à¸¿300", "open_hours": "10:00-22:00", 
                "address": "Central World 7F", "address_local": "After You",
                "coords": [13.7466, 100.5393], "note": "å¿…åƒï¼šæ³°å¥¶åˆ¨å†° (Thai Tea Kakigori)ã€æ¶‰è°·èœœç³–åå¸ã€‚\näººå¤šæ™‚éœ€å…ˆæŠ½è™Ÿç¢¼ç‰Œã€‚", "tags": ["ç¾é£Ÿ"]
            },
            {
                "time": "19:00", "title": "Jodd Fairs å¤œå¸‚", "type": "å¤œå¸‚", "price": "-", "open_hours": "16:00-00:00", 
                "address": "Rama IX Rd, Bangkok", "address_local": "à¸ˆà¹Šà¸­à¸”à¹à¸Ÿà¸£à¹Œ à¸à¸£à¸°à¸£à¸²à¸¡ 9",
                "coords": [13.7569, 100.5665], "note": "MRT Phra Ram 9 ç«™ã€‚\nå¿…åƒï¼šç«å±±æ’éª¨ã€æ°´æœè¥¿æ–½å†°æ²™ã€‚\näººæ½®æ“æ“ ï¼Œæ³¨æ„éš¨èº«è²¡ç‰©ã€‚", "tags": ["ç¾é£Ÿ", "é€›è¡—"]
            }
        ],
        "inspiration": [],
        "shopping": ["Poy-Sian è–„è·æ£’", "å°è€é—†æµ·è‹”"]
    },
    "day4": {
        "date": "2026-05-04", "display": "May 04", "weekday": "é€±ä¸€",
        "events": [
            {
                "time": "10:30", "title": "Jim Thompson House", "type": "æ–‡åŒ–", "price": "à¸¿200", "open_hours": "10:00-18:00", 
                "address": "6 Soi Kasemsan 2, Rama 1 Rd, Bangkok", "address_local": "à¸à¸´à¸à¸´à¸˜à¸ à¸±à¸“à¸‘à¹Œà¸šà¹‰à¸²à¸™à¸ˆà¸´à¸¡ à¸—à¸­à¸¡à¸›à¹Œà¸ªà¸±à¸™",
                "coords": [13.7495, 100.5284], "note": "BTS National Stadium ç«™ã€‚\næ³°çµ²å¤§ç‹æ•…å±…ï¼Œéå¸¸å„ªé›…çš„æŸšæœ¨å»ºç¯‰ç¾¤ã€‚\nå…§æœ‰æ³°çµ²å°ˆè³£åº—ï¼Œå“è³ªæ¥µä½³ã€‚", "tags": ["æ–‡åŒ–"]
            },
            {
                "time": "13:00", "title": "BACC è—è¡“ä¸­å¿ƒ", "type": "å±•è¦½", "price": "å…è²»", "open_hours": "10:00-20:00", 
                "address": "939 Rama I Rd, Bangkok", "address_local": "à¸«à¸­à¸¨à¸´à¸¥à¸›à¸§à¸±à¸’à¸™à¸˜à¸£à¸£à¸¡à¹à¸«à¹ˆà¸‡à¸à¸£à¸¸à¸‡à¹€à¸—à¸à¸¡à¸«à¸²à¸™à¸„à¸£",
                "coords": [13.7467, 100.5303], "note": "å°±åœ¨ Jim Thompson å°é¢ã€‚\nå»ºç¯‰æœ¬èº«å°±æ˜¯è—è¡“ï¼Œèºæ—‹å¡é“å¾ˆå¥½æ‹ã€‚\næœ‰å¾ˆå¤šæ–‡å‰µå°åº—ã€‚", "tags": ["æ–‡é’", "å†·æ°£"]
            },
            {
                "time": "18:00", "title": "T-One Building (Tichuca)", "type": "é…’å§", "price": "à¸¿500+", "open_hours": "17:00-00:00", 
                "address": "T-One Building 46F, Bangkok", "address_local": "à¸•à¸¶à¸ T-One à¸Šà¸±à¹‰à¸™ 46",
                "coords": [13.7229, 100.5807], "note": "ç¶²ç´…ã€Œæ°´æ¯é…’å§ã€ã€‚\né›¢é£¯åº— (Thong Lo) å¾ˆè¿‘ã€‚\nå»ºè­° 17:30 å‰åˆ°çœ‹å¤•é™½ï¼Œä¸ç”¨æ’éšŠã€‚", "tags": ["å¤œç”Ÿæ´»", "æ‹ç…§"]
            }
        ],
        "inspiration": [],
        "shopping": ["æ³°çµ²çµ²å·¾", "æ–‡å‰µæ˜ä¿¡ç‰‡"]
    },
    "day5": {
        "date": "2026-05-05", "display": "May 05", "weekday": "é€±äºŒ",
        "events": [
            {
                "time": "11:00", "title": "EmQuartier / EmSphere", "type": "è³¼ç‰©", "price": "-", "open_hours": "10:00-22:00", 
                "address": "Sukhumvit Rd, Bangkok", "address_local": "à¹€à¸­à¹‡à¸¡à¸„à¸§à¸­à¹€à¸—à¸µà¸¢à¸£à¹Œ",
                "coords": [13.7319, 100.5698], "note": "BTS Phrom Phong ç«™ã€‚\næœ€å¾Œè£œè²¨æ©Ÿæœƒã€‚\nGourmet Market è¶…å¸‚è²·ä¼´æ‰‹ç¦®æœ€é½Šå…¨ã€‚\nåˆé¤å¯åœ¨é€™è£¡è§£æ±ºã€‚", "tags": ["è³¼ç‰©"]
            },
            {
                "time": "14:00", "title": "å‰å¾€æ©Ÿå ´ (BKK)", "type": "ç§»å‹•", "price": "-", "open_hours": "-", 
                "address": "Suvarnabhumi Airport", "address_local": "à¸—à¹ˆà¸²à¸­à¸²à¸à¸²à¸¨à¸¢à¸²à¸™à¸ªà¸¸à¸§à¸£à¸£à¸“à¸ à¸¹à¸¡à¸´",
                "coords": [13.6900, 100.7501], "note": "å›é£¯åº—æ‹¿è¡Œæã€‚\né è¨ˆ 14:30 é›¢é–‹å¸‚å€ã€‚\nå¡è»Šé¢¨éšªé«˜ï¼Œå»ºè­°é ç•™å……è¶³æ™‚é–“ã€‚", "tags": ["ç§»å‹•"]
            }
        ],
        "shopping": ["æ©Ÿå ´å…ç¨…åº—åŒ–å¦å“", "èŠ’æœä¹¾"]
    }
};

const TRIP_INFO = {
    visa: { type: "Visa Exemption", number: "å…ç°½è­‰ (30å¤©)", expiry: "-", note: "å…¥å¢ƒè«‹æº–å‚™å›ç¨‹æ©Ÿç¥¨è­‰æ˜èˆ‡ä½å®¿è¨‚å–®å‚™æŸ¥ã€‚" },
    flights: [
        { type: "å»ç¨‹", flight: "CX751", date: "05/01", dep: "HKG 14:25", arr: "BKK 16:20", note: "BKK ç´ è¬é‚£æ™®æ©Ÿå ´", bookingRef: "BK8899" },
        { type: "å›ç¨‹", flight: "CX708", date: "05/05", dep: "BKK 17:30", arr: "HKG 21:25", note: "ææ—© 2.5 å°æ™‚æŠµé”æ©Ÿå ´", bookingRef: "BK8899" }
    ],
    hotels: [
        { name: "IR-ON Hotel", address: "10/10 Sukhumvit 36, Klongton, Klongtoey, Bangkok", phone: "+6620740806" }
    ],
    emergency: [
        { name: "æ—…éŠè­¦å¯Ÿ", phone: "1155" },
        { name: "æ•‘è­·è»Š", phone: "1669" }
    ]
};

let currentDay = "day1";
let modalMap = null;
let currentEventData = null;
let exchangeRate = 0.22; // Default fallback
let weatherCache = null;
let shopState = {}; 

function init() { 
    renderDateSelector(); selectDay('day1'); 
    switchMainPage('itinerary', document.querySelector('.nav-item.active'));
    fetchRates(); fetchWeather();
    if(localStorage.getItem('travelMemo')) document.getElementById('quick-memo').value = localStorage.getItem('travelMemo');
    if(localStorage.getItem('shopState')) shopState = JSON.parse(localStorage.getItem('shopState'));
    renderInfoPage();
}

function renderInfoPage() {
    const container = document.getElementById('dynamic-info-content');
    if(!container) return;
    let html = '';

    // Flights
    if(TRIP_INFO.flights && TRIP_INFO.flights.length > 0) {
        html += `<div class="info-card"><div class="info-header">èˆªç­è³‡æ–™</div>`;
        TRIP_INFO.flights.forEach(f => {
            const icon = f.type === "å»ç¨‹" ? "fa-plane-departure" : "fa-plane-arrival";
            html += `<div class="info-row"><div class="info-icon"><i class="fa-solid ${icon}"></i></div><div style="width:100%;"><div><span class="info-label">${f.type} â€¢ ${f.flight}</span><div style="font-weight:600;">${f.dep} â ${f.arr}</div><div style="font-size:0.8rem; color:#A0A0A0;">${f.note}</div></div></div></div>`;
            if(f !== TRIP_INFO.flights[TRIP_INFO.flights.length-1]) html += `<div style="height:1px; background:rgba(255,255,255,0.1); margin:10px 0;"></div>`;
        });
        html += `</div>`;
    }

    // Hotels
    if(TRIP_INFO.hotels) {
        html += `<div class="info-card"><div class="info-header">ä½å®¿</div>`;
        TRIP_INFO.hotels.forEach(h => {
             html += `<div class="info-row"><div class="info-icon"><i class="fa-solid fa-hotel"></i></div><div><span class="info-label">é£¯åº—</span><div>${h.name}</div></div></div>`;
             html += `<div class="info-row"><div class="info-icon"><i class="fa-solid fa-map-location-dot"></i></div><div><span class="info-label">åœ°å€</span><div style="font-size:0.9rem;">${h.address}</div></div></div>`;
             if(h.phone) html += `<div class="info-row"><div class="info-icon"><i class="fa-solid fa-phone"></i></div><div><span class="info-label">é›»è©±</span><div>${h.phone}</div></div></div>`;
        });
        html += `</div>`;
    }

    // Emergency
    html += `<div class="info-card"><div class="info-header">ç·Šæ€¥è¯çµ¡</div>`;
    TRIP_INFO.emergency.forEach(e => {
        html += `<div class="info-row"><div class="info-icon"><i class="fa-solid fa-shield-halved"></i></div><div style="width:100%; display:flex; justify-content:space-between; align-items:center;"><div><span class="info-label">${e.name}</span><span>${e.phone}</span></div><a href="tel:${e.phone}" class="btn-icon-sm" style="width:30px; height:30px; background:#333; display:flex; justify-content:center; align-items:center; border-radius:50%; color:#FFF;"><i class="fa-solid fa-phone"></i></a></div></div>`;
    });
    html += `</div>`;
    
    container.innerHTML = html;
}

async function fetchRates(force = false) {
    const statusEl = document.getElementById('rate-display');
    statusEl.innerHTML = '<i class="fa-solid fa-sync fa-spin"></i> æ›´æ–°ä¸­...';
    try {
        const res = await fetch('https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/thb.json');
        const data = await res.json();
        if(data.thb && data.thb.hkd) {
            exchangeRate = data.thb.hkd;
            statusEl.innerHTML = `1 THB â‰ˆ ${exchangeRate.toFixed(4)} HKD`;
            convertCurrency();
        }
    } catch(e) { statusEl.innerHTML = `é è¨­åŒ¯ç‡: ${exchangeRate}`; }
}

async function fetchWeather() {
    const container = document.getElementById('weather-content');
    const fallbackMsg = document.getElementById('weather-fallback-msg');
    const lat = 13.7563; const lon = 100.5018; // Bangkok
    
    // Smart Fallback Logic: Since 2026 is far, the API might not return data or specific daily forecast.
    // We try to fetch. If it fails or returns no data for our dates, we trigger renderHistoricalWeather.
    try {
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max,uv_index_max,sunrise,sunset&timezone=auto&forecast_days=14`;
        const res = await fetch(url); 
        const data = await res.json();
        
        // Simple check: if valid daily data exists
        if(data && data.daily && data.daily.time && data.daily.time.length > 0) {
             weatherCache = data;
             if(document.getElementById('page-weather').classList.contains('active')) renderWeatherModule();
        } else {
             throw new Error("No data");
        }
    } catch(e) { 
        console.log("Weather API unavailable or date too far. Using Historical Fallback.");
        renderHistoricalWeather(); 
    }
}

function renderWeatherModule() {
    const container = document.getElementById('weather-content');
    const d = weatherCache.daily; const idx = 0; // Show first day for demo
    
    container.innerHTML = buildWeatherHTML(
        Math.round(d.temperature_2m_max[idx]),
        Math.round(d.temperature_2m_min[idx]),
        d.precipitation_probability_max ? d.precipitation_probability_max[idx] : 10,
        d.uv_index_max ? d.uv_index_max[idx] : 11,
        "å³æ™‚é å ±"
    );
}

function renderHistoricalWeather() {
    // Bangkok in May (Historical Averages)
    // High: 35C, Low: 27C, Rain: 40% (Rainy season start), UV: Extreme
    const container = document.getElementById('weather-content');
    document.getElementById('weather-fallback-msg').style.display = 'block';
    
    container.innerHTML = buildWeatherHTML(35, 27, 40, 11, "æ­·å²å¹³å‡ (5æœˆ)");
}

function buildWeatherHTML(max, min, rain, uv, label) {
    return `
    <div class="weather-main-card">
    <div style="font-size:0.9rem; opacity:0.8; margin-bottom:5px; color:#FFF; text-transform:uppercase; letter-spacing:1px;">${label} â€¢ æ›¼è°·</div>
    <div class="weather-icon-lg" style="color:#f39c12"><i class="fa-solid fa-cloud-sun-rain"></i></div>
    <div class="weather-temp-lg">${max}Â°</div>
    <div class="weather-desc">æ‚¶ç†± / é«”æ„Ÿ 40Â°+</div>
    </div>
    <div class="weather-grid">
    <div class="weather-stat-card"><i class="fa-solid fa-umbrella" style="color:#3498db; margin-bottom:5px;"></i><span style="font-size:0.7rem; color:#A0A0A0;">é™é›¨æ©Ÿç‡</span><span style="font-size:1.1rem; font-weight:bold;">${rain}%</span></div>
    <div class="weather-stat-card"><i class="fa-solid fa-sun" style="color:orange; margin-bottom:5px;"></i><span style="font-size:0.7rem; color:#A0A0A0;">ç´«å¤–ç·š</span><span style="font-size:1.1rem; font-weight:bold;">${uv}+</span></div>
    </div>
    <div style="text-align:center; font-size:0.8rem; color:#A0A0A0; margin-top:20px; padding:0 20px;">
        <i class="fa-solid fa-shirt"></i> å»ºè­°ç©¿è‘—ï¼šé€æ°£æ£‰éº»æè³ªï¼Œå‹™å¿…æ”œå¸¶æŠ˜å‚˜èˆ‡é˜²æ›¬ä¹³ã€‚
    </div>
    `;
}

function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('sidebar-overlay').classList.toggle('open'); }
function openTranslate() { window.open("https://translate.google.com/?sl=auto&tl=zh-TW", "_blank"); }
function navigateTo(pageId) { toggleSidebar(); switchMainPage(pageId); }

function switchMainPage(pageId, navEl) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + pageId).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    if(navEl) navEl.classList.add('active'); else {
        if(pageId=='itinerary') document.querySelectorAll('.nav-item')[0].classList.add('active');
        if(pageId=='inspiration') document.querySelectorAll('.nav-item')[1].classList.add('active');
        if(pageId=='shopping') document.querySelectorAll('.nav-item')[2].classList.add('active');
        if(pageId=='weather') document.querySelectorAll('.nav-item')[3].classList.add('active');
        if(pageId=='info') document.querySelectorAll('.nav-item')[4].classList.add('active');
    }
    const ds = document.querySelector('.date-selector-container');
    if(['itinerary','shopping','inspiration','weather'].includes(pageId)) ds.style.display = 'block'; else ds.style.display = 'none';
    if(pageId === 'weather') fetchWeather();
}

function convertCurrency() {
    const thb = parseFloat(document.getElementById('curr-thb').value);
    if(!isNaN(thb)) { document.getElementById('curr-hkd').value = (thb * exchangeRate).toFixed(1); } else { document.getElementById('curr-hkd').value = ""; }
}
function saveMemo() { localStorage.setItem('travelMemo', document.getElementById('quick-memo').value); }
function sendWhatsApp() {
    let phone = document.getElementById('wa-phone').value.replace(/\D/g, '');
    if(!phone) { alert("è«‹è¼¸å…¥å°æ–¹é›»è©±è™Ÿç¢¼"); return; }
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((pos) => {
            const mapLink = `https://www.google.com/maps/search/?api=1&query=${pos.coords.latitude},${pos.coords.longitude}`;
            const text = `æˆ‘ç¾åœ¨åœ¨æ›¼è°·é€™è£¡ï¼Œä¸€åˆ‡å¹³å®‰ï¼\n${mapLink}`;
            window.location.href = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
        }, () => { alert("ç„¡æ³•ç²å–ä½ç½®"); });
    } else alert("ç€è¦½å™¨ä¸æ”¯æ´å®šä½");
}
function showPhrase(jp, zh) { document.getElementById('overlay-jp').innerText = jp; document.getElementById('overlay-zh').innerText = zh; document.getElementById('phrase-overlay').classList.add('active'); }
function closePhrase() { document.getElementById('phrase-overlay').classList.remove('active'); }

function renderDateSelector() {
    const container = document.getElementById('date-selector'); container.innerHTML = '';
    Object.keys(scheduleData).forEach(dayKey => {
        const day = scheduleData[dayKey];
        const chip = document.createElement('div'); chip.className = `date-chip`;
        chip.id = `chip-${dayKey}`;
        chip.onclick = () => selectDay(dayKey, chip);
        chip.innerHTML = `<span class="day-num">${day.display}</span><span class="day-week">${day.weekday}</span>`;
        container.appendChild(chip);
    });
    if(container.firstChild) container.firstChild.classList.add('active');
}

function selectDay(dayKey, chipEl) {
    currentDay = dayKey;
    document.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active'));
    if(chipEl) chipEl.classList.add('active'); else document.getElementById(`chip-${dayKey}`).classList.add('active');
    if(chipEl) chipEl.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    renderTimeline(dayKey); renderInspiration(dayKey); renderShopping(dayKey);
    if(document.getElementById('page-weather').classList.contains('active')) fetchWeather();
}

function renderTimeline(dayKey) {
    const container = document.getElementById('timeline-container'); container.innerHTML = '';
    const events = scheduleData[dayKey].events || [];
    events.forEach(event => {
        const item = document.createElement('div'); item.className = 'timeline-item';
        let tags = event.tags.map(t => `<span class="card-tag">${t}</span>`).join('');
        const navBtn = `<div class="card-nav-btn" onclick="event.stopPropagation(); openMapQuery('${event.address}')"><i class="fa-solid fa-location-arrow"></i></div>`;
        item.innerHTML = `<div class="card" onclick='openModal(${JSON.stringify(event).replace(/'/g, "'")})'>${navBtn}<span class="card-time">${event.time}</span><h3 class="card-title">${event.title}</h3><div class="tags">${tags}</div></div>`;
        container.appendChild(item);
    });
    container.appendChild(document.createElement('div')).style.height = "20px";
}
function renderInspiration(dayKey) {
    const container = document.getElementById('inspiration-container'); container.innerHTML = '';
    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
    document.querySelector('.filter-chip').classList.add('active');
    const items = scheduleData[dayKey].inspiration || [];
    if(items.length===0) container.innerHTML = "<div style='text-align:center; padding:30px; color:#999;'>æœ¬æ—¥ç„¡éˆæ„Ÿç­†è¨˜</div>";
    items.forEach(item => { container.innerHTML += `<div class="inspire-card" data-tag="${item.tag}"><div class="inspire-badge">${item.tag}</div><h3>${item.title}</h3><p style="margin:5px 0 0 0; font-size:0.9rem; color:#A0A0A0;">${item.note}</p></div>`; });
}
function filterInspiration(tag, btn) {
    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active')); btn.classList.add('active');
    document.querySelectorAll('.inspire-card').forEach(card => { if(tag === 'all' || card.getAttribute('data-tag') === tag) card.classList.remove('hidden'); else card.classList.add('hidden'); });
}
function renderShopping(dayKey) {
    const container = document.getElementById('shopping-container'); container.innerHTML = '';
    const items = scheduleData[dayKey].shopping || [];
    items.forEach((item, idx) => { 
        const uid = `${dayKey}-${idx}`; const chk = shopState[uid] ? 'checked' : '';
        container.innerHTML += `<div class="shop-item ${chk}"><input type="checkbox" id="${uid}" ${chk} onchange="toggleShopItem(this, '${uid}')"><label for="${uid}">${item}</label></div>`; 
    });
}
function toggleShopItem(cb, id) { shopState[id] = cb.checked; localStorage.setItem('shopState', JSON.stringify(shopState)); cb.closest('.shop-item').classList.toggle('checked'); }

function openMapQuery(address) { window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`, '_blank'); }
function searchGmail(query) { window.open(`https://mail.google.com/mail/u/0/#search/${encodeURIComponent(query)}`, '_blank'); }
function copyToClipboard(text) { navigator.clipboard.writeText(text).then(() => { alert("å·²è¤‡è£½"); }); }

function openModal(data) {
    currentEventData = data;
    document.getElementById('modal-title').innerText = data.title;
    document.getElementById('modal-type').innerText = data.type;
    document.getElementById('modal-time').innerText = data.time;
    document.getElementById('modal-price').innerText = data.price;
    document.getElementById('modal-open-hours').innerText = data.open_hours || "å¾…ç¢ºèª";
    document.getElementById('modal-address-short').innerText = data.address;
    document.getElementById('modal-note').innerText = data.note;
    
    const actionsContainer = document.getElementById('modal-actions');
    actionsContainer.innerHTML = '';
    
    actionsContainer.innerHTML += `<button class="btn-action btn-outline" onclick="openMapQuery('${data.address}')"><i class="fa-solid fa-location-arrow"></i> Google Maps å°èˆª</button>`; 
    if (data.type.includes('æ™šé¤') || data.type.includes('åˆé¤') || data.type.includes('æŒ‰æ‘©')) { actionsContainer.innerHTML += `<button class="btn-action btn-outline" onclick="searchGmail('${data.title}')">ğŸ” æœå°‹é ç´„ä¿¡</button>`; } 
    
    // Taxi Card (Thai Address)
    if(data.address_local) {
        actionsContainer.innerHTML += `<button class="btn-action btn-black" onclick="showPhrase('${data.address_local}', 'è«‹è¼‰æˆ‘å»é€™è£¡')">ğŸš• çµ¦å¸æ©Ÿçœ‹ (æ³°æ–‡)</button>`;
    } else {
        actionsContainer.innerHTML += `<button class="btn-action btn-black" onclick="showPhrase('${data.address}', 'è«‹è¼‰æˆ‘å»é€™è£¡')">ğŸš• çµ¦å¸æ©Ÿçœ‹ (è‹±æ–‡)</button>`;
    }

    document.getElementById('detail-modal').classList.add('open');
    setTimeout(() => { if(modalMap) modalMap.remove(); modalMap = L.map('modal-mini-map', {zoomControl:false, dragging:false}).setView(data.coords, 15); L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(modalMap); L.marker(data.coords, {icon: L.divIcon({className:'custom-div-icon',html:"<div style='background:#D4AF37;width:14px;height:14px;border-radius:50%;border:2px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);'></div>",iconSize:[14,14]})}).addTo(modalMap); modalMap.invalidateSize(); }, 100);
}

init();
</script>
</body>
</html>
